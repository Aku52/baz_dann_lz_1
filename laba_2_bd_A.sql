CREATE TABLE GROUPS (
  ID_GR INT NOT NULL IDENTITY(1,1),
  NAME_GR CHAR(20) NOT NULL,
  COURSE_GR INT NOT NULL,
  
  CONSTRAINT PK_GROUPS PRIMARY KEY (ID_GR))
  
CREATE TABLE STUDENTS (
  ID_ST INT NOT NULL IDENTITY(1,1),
  NAME_ST CHAR(20) NOT NULL,
  SURNAME_ST CHAR(20) NOT NULL,
  T_NAME_ST CHAR(20),
  BIRTH_ST DATE NOT NULL,
  GR_ST INT NOT NULL,
  
  CONSTRAINT PK_STUDENTS PRIMARY KEY (ID_ST))
--CONSTRAINT FK_TO_STUDENTS FOREIGN KEY (GR_ST) REFERENCES GROUPS (ID_GR))

CREATE TABLE SUBJECTS(
  ID_PRED INT NOT NULL IDENTITY(1,1),
  NAME_PRED CHAR(50) NOT NULL,
  TIME_PRED INT NOT NULL,
  
  CONSTRAINT PK_SUBJECTS PRIMARY KEY (ID_PRED))
  
CREATE TABLE PLAN (
   ID_GR_PLAN INT NOT NULL,
   ID_PRED_PLAN INT NOT NULL,
   CONSTRAINT PK_PLAN PRIMARY KEY (ID_GR_PLAN, ID_PRED_PLAN))
   
-- CONSTRAINT FK_TO_PLAN_GR FOREIGN KEY (ID_GR_PLAN) REFERENCES GROUPS (ID_GR),
-- CONSTRAINT FK_TO_PLAN_PRED FOREIGN KEY (ID_PRED_PLAN)  SUBJECTS(TIME_PRED))
   
   
ALTER TABLE STUDENTS ADD CONSTRAINT FK_TO_STUDENTS FOREIGN KEY (GR_ST) REFERENCES GROUPS (ID_GR)
ALTER TABLE PLAN ADD CONSTRAINT FK_TO_PLAN_GR FOREIGN KEY (ID_GR_PLAN) REFERENCES GROUPS (ID_GR)
ALTER  TABLE PLAN ADD CONSTRAINT FK_TO_PLAN_PRED FOREIGN KEY (ID_PRED_PLAN) REFERENCES SUBJECTS(TIME_PRED)
  
ALTER TABLE STUDENTS ADD NAME_GR_ST INT    
ALTER TABLE STUDENTS ADD COURSE_GR_ST CHAR(20) 
ALTER TABLE STUDENTS ADD CONSTRAINT FK_TO_STUDENTS_COURSE FOREIGN KEY (COURSE_GR_ST) REFERENCES GROUPS(COURSE_GR)
ALTER TABLE STUDENTS ADD CONSTRAINT FK_TO_STUDENTS_NAME_GR FOREIGN KEY (NAME_GR_ST) REFERENCES GROUPS(NAME_GR)   

INSERT INTO STUDENTS (NAME_ST,SURNAME_ST, T_NAME_ST , BIRTH_ST, NAME_GR_ST,COURSE_GR_ST ) VALUES
('Федоренко', 'П.', 'Р.', '1997-12-25','ПО135',1),
('Зингел', 'О.', NULL, '1985-12-25','ПО135',1),
('Савицкаян', 'Н.', NULL, '1987-09-22','ПО235',2),
('Ковальчук', 'М.', 'Е.', '1992-06-17', 'ПО235',2),
('Ковриго', 'Т.', 'Р.', '1992-05-13', 'ПО335',3),
('Шарапо', 'Н.', NULL, '1992-08-14','ПО335',3)

SELECT NAME_ST,SURNAME_ST, T_NAME_ST , BIRTH_ST, COURSE_GR_ST FROM STUDENTS 

ALTER TABLE SUBJECTS ADD SUB_TIME INT
ALTER TABLE SUBJECTS ADD COURSE_GR_SUB INT
ALTER  TABLE SUBJECTS ADD CONSTRAINT FK_TO_SUBJECTS_COURSE FOREIGN KEY (COURSE_GR_SUB) REFERENCES GROUPS(COURSE_GR)

INSERT INTO SUBJECTS (NAME_PRED,COURSE_GR_SUB,SUB_TIME) VALUES
('Физика',1,200),
('Математика',1,120),
('Основы алгоритма',2,70),
('Проектирование БД',2,130),
('Средства визуального программирования',3,90),
('Объектно-ориентированное программирование',3,70)

SELECT NAME_PRED,COURSE_GR_SUB,COURSE_GR_SUB FROM SUBJECTS

UPDATE STUDENTS SET  NAME_GR_ST='ПО135' where NAME_GR_ST=134
DELETE NAME_GR_ST FROM STUDENTS WHERE NAME_GR_ST='ПО135'
   
UPDATE S
SET S.NAME_GR_ST = 120
FROM STUDENTS S
JOIN PLAN P ON S.GR_ST = P.ID_GR_PLAN
JOIN SUBJECTS SUB ON P.ID_PRED_PLAN = SUB.ID_PRED
WHERE SUB.NAME_PRED = 'Средства визуального программирования'

UPDATE S
SET S.NAME_GR_ST = 100
FROM STUDENTS S
JOIN PLAN P ON S.GR_ST = P.ID_GR_PLAN
JOIN SUBJECTS SUB ON P.ID_PRED_PLAN = SUB.ID_PRED
WHERE SUB.NAME_PRED = 'Объектно-ориентированное программирование'

ALTER TABLE SUBJECTS ADD CONTROL_SUB CHAR(10)
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Физика'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Математика'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЗАЧ' WHERE NAME_PRED = 'Основы алгоритма'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Проектирование БД'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Средства визуального программирования'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Объектно-ориентированное программирование'

   
SELECT NAME_PRED,COURSE_GR_SUB,COURSE_GR_SUB,CONTROL_SUB FROM SUBJECTS

DELETE T_NAME_ST FROM STUDENTS WHERE 
   
--lab_2

--1
SELECT * FROM STUDENTS
	WHERE SURNAME_ST LIKE '%о%' OR SURNAME_ST LIKE '%б%'
 
--2 
SELECT * FROM STUDENTS
	WHERE SURNAME_ST LIKE 'К%' and T_NAME_ST IS NULL
  
--3  
SELECT * FROM STUDENTS
	WHERE LENGTH(SURNAME_ST) >= 8
--4    
SELECT * FROM STUDENTS
	WHERE (LENGTH(SURNAME_ST) > 7 OR LENGTH(SURNAME_ST) < 7)
  	AND SURNAME_ST LIKE '%а%'


CREATE TABLE FACULTET(
  ID_FAC INT NOT NULL IDENTITY(1,1),
  NAME_ST_2 CHAR(20) NOT NULL,
  SURNAME_ST_2 CHAR(20) NOT NULL,
  T_NAME_ST_2 CHAR(20),
  COURSE_GR_ST_2  INT NOT NULL,
  SRED_BALL INT,
  TUP_OB_ST CHAR(20) NOT NULL,
  FACUL_ST CHAR(20) NOT NULL,
  
  CONSTRAINT PK_FACULTET PRIMARY KEY (ID_FAC),
  CONSTRAINT FK_TO_PREPOD_COURSE FOREIGN KEY (COURSE_GR_ST_2) REFERENCES SUBJECTS(COURSE_GR_SUB))
  
INSERT INTO FACULTET (NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2 , COURSE_GR_ST_2,SRED_BALL, TUP_OB_ST, FACUL_ST ) VALUES
('Федоренко', 'П.', 'Р.', 1, 7, 'очный','ФПК'),
('Зингел', 'О.', NULL, 1, NULL, 'заочный','ФПМ'),
('Иванов', 'Н.', 'В.', 1, 5, 'заочный','ФПК'),
('Петрушевич', 'П.', 'П.', 1, 9, 'очный','ФПМ'),
('Федосевич', 'Р.', 'Д.', 2, 4, 'очный','ФПК'),
('Заборовский', 'А.', 'Р.', 2, 6, 'очный','ФПМ'),
('Савицкаян', 'Н.', NULL, 2, 7, 'заочный','ФПК'),
('Ковальчук', 'М.', 'Е.', 2, 8,'заочный','ФПМ'),
('Ковриго', 'Т.', 'Р.', 3, 8, 'очный','ФПМ'),
('Ковальский', 'А.', 'С.', 3, 9, 'заочный','ФПМ'),
('Степанчук', 'И.', 'Н.', 3, 6, 'заочный','ФПК'),
('Шарапо', 'Н.', NULL, 3, 7, 'очный','ФПК')
 
--5
SELECT * FROM FACULTET
	WHERE FACUL = 'ФПМ' AND TUP_OB = 'очный' 
 	AND (COURSE_GR_ST_2 = 1 OR COURSE_GR_ST_2 = 2)
    ORDER BY T_NAME_ST_2

--6
SELECT * FROM FACULTET
  WHERE FACUL = 'ФПК' AND TUP_OB = 'заочный' 
  AND SRED_BALL > 6
  ORDER BY SRED_BALL DESC
  
CREATE TABLE PREPOD (
  ID_PRE INT NOT NULL IDENTITY(1,1),
  NAME_PREP CHAR(20) NOT NULL,
  SURNAME_PREP CHAR(20) NOT NULL,
  T_NAME_PREP CHAR(20),
  BIRTH_PREP DATE,
  PREDMET_PREP CHAR(30) NOT NULL,
  COURSE_GR_PREP  INT NOT NULL,
  FACUL_PREP CHAR(20) NOT NULL,
  TUP_OB_PREP CHAR(20)NOT NULL,
  TIME_PREP INT NOT NULL,
  TIME_WORK_PREP DATE NOT NULL,
   
 CONSTRAINT PK_PREPOD PRIMARY KEY (ID_PRE )
 CONSTRAINT FK_TO_PREPOD_PREDMET FOREIGN KEY (PREDMET_PREP) REFERENCES SUBJECTS(NAME_PRED),
 CONSTRAINT FK_TO_PREPOD_TIME FOREIGN KEY (TIME_PREP) REFERENCES SUBJECTS(SUB_TIME),
 CONSTRAINT FK_TO_PREPOD_COURSE FOREIGN KEY (COURSE_GR_PREP) REFERENCES FACULTET(COURSE_GR_ST_2)
 CONSTRAINT FK_TO_PREPOD_TUP_OB FOREIGN KEY (TUP_OB_PREP) REFERENCES FACULTET(TUP_OB_ST) 
 CONSTRAINT FK_TO_PREPOD_FACUL FOREIGN KEY (FACUL_PREP) REFERENCES FACULTET(FACUL_ST))

INSERT INTO PREPOD (NAME_PREP,SURNAME_PREP, T_NAME_PREP ,COURSE_GR_PREP,BIRTH_PREP, TUP_OB_PREP, FACUL_PREP, PREDMET_PREP, TIME_PREP,TIME_WORK_PREP ) VALUES
('Тарасов', 'Т.', 'П.', 2, '1997-11-05','очный','ФПК','Проектирование БД', 130,'2007-08-05'),
('Алианелла', 'А.', NULL, 1, '1990-03-15', 'заочный','ФПМ','Физика',200,'2015-11-05'),
('Печкин', 'Н.', 'В.', 2,  '2001-07-25','заочный','ФПК','Основы алгоритма',70,'2010-11-05'),
('Зайцев', 'П.', 'П.', 3,'1986-06-18', 'очный','ФПМ','Средства визуального программирования',90,'2006-11-05'),
('Фадеев', 'Р.', 'М.', 3, '1989-08-30', 'очный','ФПК','Средства визуального программирования',90,'2007-11-05'),
('Табалов', 'Ф.', 'Р.', 1, '1975-04-07', 'очный','ФПМ','Физика',200,'2011-11-05'),
('Треппион', 'Х.', NULL, 3, '1968-08-16', 'очный','ФПК','Объектно-ориентированное программирование',70,'2016-11-05'),
('Кравцов', 'С.', 'Е.', 2, '1993-10-30','заочный','ФПМ','Проектирование БД',130,'2023-11-05'),
('Никулев', 'В.', 'Р.', 1, '1958-02-25', 'очный','ФПМ','Физика',200,'2001-11-05'),
('Шмель', 'А.', 'С.', 1, '1965-09-05','заочный','ФПМ','Математика',120,'2013-11-05'),
('Новицкий', 'Т.', 'Н.', 3, '1987-12-19','заочный','ФПК','Объектно-ориентированное программирование',70,'2017-11-05'),
('Храпеников', 'Н.', NULL, 2, '1992-10-23',  'очный','ФПК','Основы алгоритма',70,'2010-11-05'),
('Беляев', 'И.', 'Л.', 1, '1998-04-12', 'очный', 'ФПК', 'Математика', 120,'2009-11-05'),
('Смирнова', 'Е.', 'А.', 1, '1991-09-03', 'заочный', 'ФПМ', 'Физика', 200,'2008-11-05'),
('Горбач', 'К.', 'Н.', 2, '1980-01-27', 'очный', 'ФПК', 'Проектирование БД', 130,'2014-11-05'),
('Лебедь', 'М.', NULL, 2, '1995-06-14', 'заочный', 'ФПМ', 'Основы алгоритма', 70,'2021-11-05'),
('Дьяченко', 'Т.', 'Г.', 3, '2000-11-22', 'очный', 'ФПК', 'Объектно-ориентированное программирование', 70,'2016-11-05'),
('Ермаков', 'С.', 'П.', 3, '1983-03-09', 'заочный', 'ФПМ', 'Средства визуального программирования', 90,'2017-11-05'),
('Козлова', 'А.', 'В.', 1, '1996-07-30', 'очный', 'ФПК', 'Физика', 200,'2025-11-05'),
('Мелицкий', 'Ю.', NULL, 1, '1999-12-05', 'заочный', 'ФПМ', 'Математика', 120, '2024-11-05'),
('Романов', 'Н.', 'С.', 2, '1988-05-18', 'очный', 'ФПК', 'Проектирование БД', 130,'2021-11-05'),
('Соловей', 'Д.', 'И.', 2, '1979-08-21', 'очный', 'ФПМ', 'Основы алгоритма', 70,'2022-11-05')

--7
SELECT * FROM PREPOD
	where FACUL_PREP = 'ФПК'
	ORDER BY SURNAME_PREP, TUP_OB_PREP
   
--8   
SELECT * FROM PREPOD
	where FACUL_PREP = 'ФПМ' AND COURSE_GR_PREP = 1 AND TIME_PREP > 100
 
 --9
SELECT * FROM PREPOD
	WHERE T_NAME_PREP IS NULL 
  	AND DATEDIFF(YEAR, TIME_WORK_PREP, GETDATE()) > 3

--10
SELECT PREDMET_PREP FROM PREPOD
	WHERE COURSE_GR_PREP=3 AND FACUL_PREP = 'ФПМ'
  	
--11    
SELECT COURSE_GR_PREP,TUP_OB_PREP,NAME_PREP,SURNAME_PREP, T_NAME_PREP FROM PREPOD
	WHERE FACUL_PREP = 'ФПК' AND TIME_PREP > 100    
    
--12
SELECT FACUL_PREP,COURSE_GR_PREP,TUP_OB_PREP,NAME_PREP,SURNAME_PREP, T_NAME_PREP FROM PREPOD
	WHERE T_NAME_PREP IS NULL   
    
--13
SELECT NAME_PREP,SURNAME_PREP, T_NAME_PREP,BIRTH_PREP FROM PREPOD
	WHERE DATEDIFF(YEAR, BIRTH_PREP, GETDATE()) > 30

--14
SELECT NAME_PREP, SURNAME_PREP, T_NAME_PREP, BIRTH_PREP FROM PREPOD
	WHERE DATEDIFF(YEAR, BIRTH_PREP, GETDATE()) BETWEEN 35 AND 40
	ORDER BY SURNAME_PREP

--15
SELECT NAME_PREP, SURNAME_PREP, T_NAME_PREP, BIRTH_PREP FROM PREPOD
	WHERE MONTH(BIRTH_PREP) = 10
	ORDER BY BIRTH_PREP ASC



