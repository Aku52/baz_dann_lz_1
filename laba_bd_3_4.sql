CREATE TABLE GROUPS (
  ID_GR INT NOT NULL IDENTITY(1,1),
  NAME_GR CHAR(20) NOT NULL,
  COURSE_GR INT NOT NULL,
  
  CONSTRAINT PK_GROUPS PRIMARY KEY (ID_GR))
  
CREATE TABLE STUDENTS (
  ID_ST INT NOT NULL IDENTITY(1,1),
  NAME_ST CHAR(20) NOT NULL,
  SURNAME_ST CHAR(20) NOT NULL,
  T_NAME_ST CHAR(20),
  BIRTH_ST DATE NOT NULL,
  GR_ST INT NOT NULL,
  
  CONSTRAINT PK_STUDENTS PRIMARY KEY (ID_ST))
--CONSTRAINT FK_TO_STUDENTS FOREIGN KEY (GR_ST) REFERENCES GROUPS (ID_GR))

CREATE TABLE SUBJECTS(
  ID_PRED INT NOT NULL IDENTITY(1,1),
  NAME_PRED CHAR(50) NOT NULL,
  TIME_PRED INT NOT NULL,
  
  CONSTRAINT PK_SUBJECTS PRIMARY KEY (ID_PRED))
  
CREATE TABLE PLAN (
   ID_GR_PLAN INT NOT NULL,
   ID_PRED_PLAN INT NOT NULL,
   CONSTRAINT PK_PLAN PRIMARY KEY (ID_GR_PLAN, ID_PRED_PLAN))
   
-- CONSTRAINT FK_TO_PLAN_GR FOREIGN KEY (ID_GR_PLAN) REFERENCES GROUPS (ID_GR),
-- CONSTRAINT FK_TO_PLAN_PRED FOREIGN KEY (ID_PRED_PLAN)  SUBJECTS(TIME_PRED))
   
   
ALTER TABLE STUDENTS ADD CONSTRAINT FK_TO_STUDENTS FOREIGN KEY (GR_ST) REFERENCES GROUPS (ID_GR)
ALTER TABLE PLAN ADD CONSTRAINT FK_TO_PLAN_GR FOREIGN KEY (ID_GR_PLAN) REFERENCES GROUPS (ID_GR)
ALTER  TABLE PLAN ADD CONSTRAINT FK_TO_PLAN_PRED FOREIGN KEY (ID_PRED_PLAN) REFERENCES SUBJECTS(TIME_PRED)
  
ALTER TABLE STUDENTS ADD NAME_GR_ST INT    
ALTER TABLE STUDENTS ADD COURSE_GR_ST CHAR(20) 
ALTER TABLE STUDENTS ADD CONSTRAINT FK_TO_STUDENTS_COURSE FOREIGN KEY (COURSE_GR_ST) REFERENCES GROUPS(COURSE_GR)
ALTER TABLE STUDENTS ADD CONSTRAINT FK_TO_STUDENTS_NAME_GR FOREIGN KEY (NAME_GR_ST) REFERENCES GROUPS(NAME_GR)   

INSERT INTO STUDENTS (NAME_ST,SURNAME_ST, T_NAME_ST , BIRTH_ST, NAME_GR_ST,COURSE_GR_ST ) VALUES
('Федоренко', 'П.', 'Р.', '1997-12-25','ПО135',1),
('Зингел', 'О.', NULL, '1985-12-25','ПО135',1),
('Савицкаян', 'Н.', NULL, '1987-09-22','ПО235',2),
('Ковальчук', 'М.', 'Е.', '1992-06-17', 'ПО235',2),
('Ковриго', 'Т.', 'Р.', '1992-05-13', 'ПО335',3),
('Шарапо', 'Н.', NULL, '1992-08-14','ПО335',3)

SELECT NAME_ST,SURNAME_ST, T_NAME_ST , BIRTH_ST, COURSE_GR_ST FROM STUDENTS 

ALTER TABLE SUBJECTS ADD SUB_TIME INT
ALTER TABLE SUBJECTS ADD COURSE_GR_SUB INT
ALTER  TABLE SUBJECTS ADD CONSTRAINT FK_TO_SUBJECTS_COURSE FOREIGN KEY (COURSE_GR_SUB) REFERENCES GROUPS(COURSE_GR)

INSERT INTO SUBJECTS (NAME_PRED,COURSE_GR_SUB,SUB_TIME) VALUES
('Физика',1,200),
('Математика',1,120),
('Основы алгоритма',2,70),
('Проектирование БД',2,130),
('Средства визуального программирования',3,90),
('Объектно-ориентированное программирование',3,70)

SELECT NAME_PRED,COURSE_GR_SUB,COURSE_GR_SUB FROM SUBJECTS

UPDATE STUDENTS SET  NAME_GR_ST='ПО135' where NAME_GR_ST=134
DELETE NAME_GR_ST FROM STUDENTS WHERE NAME_GR_ST='ПО135'
   
UPDATE S
SET S.NAME_GR_ST = 120
FROM STUDENTS S
JOIN PLAN P ON S.GR_ST = P.ID_GR_PLAN
JOIN SUBJECTS SUB ON P.ID_PRED_PLAN = SUB.ID_PRED
WHERE SUB.NAME_PRED = 'Средства визуального программирования'

UPDATE S
SET S.NAME_GR_ST = 100
FROM STUDENTS S
JOIN PLAN P ON S.GR_ST = P.ID_GR_PLAN
JOIN SUBJECTS SUB ON P.ID_PRED_PLAN = SUB.ID_PRED
WHERE SUB.NAME_PRED = 'Объектно-ориентированное программирование'

ALTER TABLE SUBJECTS ADD CONTROL_SUB CHAR(10)
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Физика'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Математика'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЗАЧ' WHERE NAME_PRED = 'Основы алгоритма'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Проектирование БД'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Средства визуального программирования'
UPDATE SUBJECTS SET CONTROL_SUB = 'ЭКЗ' WHERE NAME_PRED = 'Объектно-ориентированное программирование'

   
SELECT NAME_PRED,COURSE_GR_SUB,COURSE_GR_SUB,CONTROL_SUB FROM SUBJECTS

DELETE T_NAME_ST FROM STUDENTS WHERE 
   
--lab_2

--1
SELECT * FROM STUDENTS
	WHERE SURNAME_ST LIKE '%о%' OR SURNAME_ST LIKE '%б%'
 
--2 
SELECT * FROM STUDENTS
	WHERE SURNAME_ST LIKE 'К%' and T_NAME_ST IS NULL
  
--3  
SELECT * FROM STUDENTS
	WHERE LENGTH(SURNAME_ST) >= 8
--4    
SELECT * FROM STUDENTS
	WHERE (LENGTH(SURNAME_ST) > 7 OR LENGTH(SURNAME_ST) < 7)
  	AND SURNAME_ST LIKE '%а%'


CREATE TABLE FACULTET(
  ID_FAC INT NOT NULL IDENTITY(1,1),
  NAME_ST_2 CHAR(20) NOT NULL,
  SURNAME_ST_2 CHAR(20) NOT NULL,
  T_NAME_ST_2 CHAR(20),
  COURSE_GR_ST_2  INT NOT NULL,
  SRED_BALL INT,
  TUP_OB_ST CHAR(20) NOT NULL,
  FACUL_ST CHAR(20) NOT NULL,
  
  CONSTRAINT PK_FACULTET PRIMARY KEY (ID_FAC),
  CONSTRAINT FK_TO_PREPOD_COURSE FOREIGN KEY (COURSE_GR_ST_2) REFERENCES SUBJECTS(COURSE_GR_SUB))
  
INSERT INTO FACULTET (NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2 , COURSE_GR_ST_2,SRED_BALL, TUP_OB_ST, FACUL_ST ) VALUES
('Федоренко', 'П.', 'Р.', 1, 7, 'очный','ФПК'),
('Зингел', 'О.', NULL, 1, NULL, 'заочный','ФПМ'),
('Иванов', 'Н.', 'В.', 1, 5, 'заочный','ФПК'),
('Петрушевич', 'П.', 'П.', 1, 9, 'очный','ФПМ'),
('Федосевич', 'Р.', 'Д.', 2, 4, 'очный','ФПК'),
('Заборовский', 'А.', 'Р.', 2, 6, 'очный','ФПМ'),
('Савицкаян', 'Н.', NULL, 2, 7, 'заочный','ФПК'),
('Ковальчук', 'М.', 'Е.', 2, 8,'заочный','ФПМ'),
('Ковриго', 'Т.', 'Р.', 3, 8, 'очный','ФПМ'),
('Ковальский', 'А.', 'С.', 3, 9, 'заочный','ФПМ'),
('Степанчук', 'И.', 'Н.', 3, 6, 'заочный','ФПК'),
('Шарапо', 'Н.', NULL, 3, 7, 'очный','ФПК')
 
--5
SELECT * FROM FACULTET
	WHERE FACUL = 'ФПМ' AND TUP_OB = 'очный' 
 	AND (COURSE_GR_ST_2 = 1 OR COURSE_GR_ST_2 = 2)
    ORDER BY T_NAME_ST_2

--6
SELECT * FROM FACULTET
  WHERE FACUL = 'ФПК' AND TUP_OB = 'заочный' 
  AND SRED_BALL > 6
  ORDER BY SRED_BALL DESC
  
CREATE TABLE PREPOD (
  ID_PRE INT NOT NULL IDENTITY(1,1),
  NAME_PREP CHAR(20) NOT NULL,
  SURNAME_PREP CHAR(20) NOT NULL,
  T_NAME_PREP CHAR(20),
  BIRTH_PREP DATE,
  PREDMET_PREP CHAR(30) NOT NULL,
  COURSE_GR_PREP  INT NOT NULL,
  FACUL_PREP CHAR(20) NOT NULL,
  TUP_OB_PREP CHAR(20)NOT NULL,
  TIME_PREP INT NOT NULL,
  TIME_WORK_PREP DATE NOT NULL,
   
 CONSTRAINT PK_PREPOD PRIMARY KEY (ID_PRE )
 CONSTRAINT FK_TO_PREPOD_PREDMET FOREIGN KEY (PREDMET_PREP) REFERENCES SUBJECTS(NAME_PRED),
 CONSTRAINT FK_TO_PREPOD_TIME FOREIGN KEY (TIME_PREP) REFERENCES SUBJECTS(SUB_TIME),
 CONSTRAINT FK_TO_PREPOD_COURSE FOREIGN KEY (COURSE_GR_PREP) REFERENCES FACULTET(COURSE_GR_ST_2)
 CONSTRAINT FK_TO_PREPOD_TUP_OB FOREIGN KEY (TUP_OB_PREP) REFERENCES FACULTET(TUP_OB_ST) 
 CONSTRAINT FK_TO_PREPOD_FACUL FOREIGN KEY (FACUL_PREP) REFERENCES FACULTET(FACUL_ST))

INSERT INTO PREPOD (NAME_PREP,SURNAME_PREP, T_NAME_PREP ,COURSE_GR_PREP,BIRTH_PREP, TUP_OB_PREP, FACUL_PREP, PREDMET_PREP, TIME_PREP,TIME_WORK_PREP ) VALUES
('Тарасов', 'Т.', 'П.', 2, '1997-11-05','очный','ФПК','Проектирование БД', 130,'2007-08-05'),
('Алианелла', 'А.', NULL, 1, '1990-03-15', 'заочный','ФПМ','Физика',200,'2015-11-05'),
('Печкин', 'Н.', 'В.', 2,  '2001-07-25','заочный','ФПК','Основы алгоритма',70,'2010-11-05'),
('Зайцев', 'П.', 'П.', 3,'1986-06-18', 'очный','ФПМ','Средства визуального программирования',90,'2006-11-05'),
('Фадеев', 'Р.', 'М.', 3, '1989-08-30', 'очный','ФПК','Средства визуального программирования',90,'2007-11-05'),
('Табалов', 'Ф.', 'Р.', 1, '1975-04-07', 'очный','ФПМ','Физика',200,'2011-11-05'),
('Треппион', 'Х.', NULL, 3, '1968-08-16', 'очный','ФПК','Объектно-ориентированное программирование',70,'2016-11-05'),
('Кравцов', 'С.', 'Е.', 2, '1993-10-30','заочный','ФПМ','Проектирование БД',130,'2023-11-05'),
('Никулев', 'В.', 'Р.', 1, '1958-02-25', 'очный','ФПМ','Физика',200,'2001-11-05'),
('Шмель', 'А.', 'С.', 1, '1965-09-05','заочный','ФПМ','Математика',120,'2013-11-05'),
('Новицкий', 'Т.', 'Н.', 3, '1987-12-19','заочный','ФПК','Объектно-ориентированное программирование',70,'2017-11-05'),
('Храпеников', 'Н.', NULL, 2, '1992-10-23',  'очный','ФПК','Основы алгоритма',70,'2010-11-05'),
('Беляев', 'И.', 'Л.', 1, '1998-04-12', 'очный', 'ФПК', 'Математика', 120,'2009-11-05'),
('Смирнова', 'Е.', 'А.', 1, '1991-09-03', 'заочный', 'ФПМ', 'Физика', 200,'2008-11-05'),
('Горбач', 'К.', 'Н.', 2, '1980-01-27', 'очный', 'ФПК', 'Проектирование БД', 130,'2014-11-05'),
('Лебедь', 'М.', NULL, 2, '1995-06-14', 'заочный', 'ФПМ', 'Основы алгоритма', 70,'2021-11-05'),
('Дьяченко', 'Т.', 'Г.', 3, '2000-11-22', 'очный', 'ФПК', 'Объектно-ориентированное программирование', 70,'2016-11-05'),
('Ермаков', 'С.', 'П.', 3, '1983-03-09', 'заочный', 'ФПМ', 'Средства визуального программирования', 90,'2017-11-05'),
('Козлова', 'А.', 'В.', 1, '1996-07-30', 'очный', 'ФПК', 'Физика', 200,'2025-11-05'),
('Мелицкий', 'Ю.', NULL, 1, '1999-12-05', 'заочный', 'ФПМ', 'Математика', 120, '2024-11-05'),
('Романов', 'Н.', 'С.', 2, '1988-05-18', 'очный', 'ФПК', 'Проектирование БД', 130,'2021-11-05'),
('Соловей', 'Д.', 'И.', 2, '1979-08-21', 'очный', 'ФПМ', 'Основы алгоритма', 70,'2022-11-05')

--7
SELECT * FROM PREPOD
	where FACUL_PREP = 'ФПК'
	ORDER BY SURNAME_PREP, TUP_OB_PREP
   
--8   
SELECT * FROM PREPOD
	where FACUL_PREP = 'ФПМ' AND COURSE_GR_PREP = 1 AND TIME_PREP > 100
 
 --9
SELECT * FROM PREPOD
	WHERE T_NAME_PREP IS NULL 
  	AND DATEDIFF(YEAR, TIME_WORK_PREP, GETDATE()) > 3

--10
SELECT PREDMET_PREP FROM PREPOD
	WHERE COURSE_GR_PREP=3 AND FACUL_PREP = 'ФПМ'
  	
--11    
SELECT COURSE_GR_PREP,TUP_OB_PREP,NAME_PREP,SURNAME_PREP, T_NAME_PREP FROM PREPOD
	WHERE FACUL_PREP = 'ФПК' AND TIME_PREP > 100    
    
--12
SELECT FACUL_PREP,COURSE_GR_PREP,TUP_OB_PREP,NAME_PREP,SURNAME_PREP, T_NAME_PREP FROM PREPOD
	WHERE T_NAME_PREP IS NULL   
    
--13
SELECT NAME_PREP,SURNAME_PREP, T_NAME_PREP,BIRTH_PREP FROM PREPOD
	WHERE DATEDIFF(YEAR, BIRTH_PREP, GETDATE()) > 30

--14
SELECT NAME_PREP, SURNAME_PREP, T_NAME_PREP, BIRTH_PREP FROM PREPOD
	WHERE DATEDIFF(YEAR, BIRTH_PREP, GETDATE()) BETWEEN 35 AND 40
	ORDER BY SURNAME_PREP

--15
SELECT NAME_PREP, SURNAME_PREP, T_NAME_PREP, BIRTH_PREP FROM PREPOD
	WHERE MONTH(BIRTH_PREP) = 10
	ORDER BY BIRTH_PREP ASC


--lab_3/4_ ЧАСТЬ_1

--1
ALTER TABLE FACULTET ADD BIRTH_ST_2 DATE
ALTER TABLE FACULTET ADD DATA_WORK_ST DATE

UPDATE FACULTET
SET BIRTH_ST_2 = '1997-12-25', DATA_WORK_ST = '2012-09-01'
WHERE NAME_ST_2 = 'Федоренко' AND SURNAME_ST_2 = 'П.' AND T_NAME_ST_2 = 'Р.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1985-12-25', DATA_WORK_ST = '2000-09-01'
WHERE NAME_ST_2 = 'Зингел' AND SURNAME_ST_2 = 'О.' AND T_NAME_ST_2 = NULL

UPDATE FACULTET
SET BIRTH_ST_2 = '1997-12-25', DATA_WORK_ST = '2002-09-01'
WHERE NAME_ST_2 = 'Иванов' AND SURNAME_ST_2 = 'Н.' AND T_NAME_ST_2 = 'В.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1987-09-22', DATA_WORK_ST = '2014-09-01'
WHERE NAME_ST_2 = 'Петрушевич' AND SURNAME_ST_2 = 'П.' AND T_NAME_ST_2 = 'П.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1992-05-13', DATA_WORK_ST = '2015-09-01'
WHERE NAME_ST_2 = 'Федосевич' AND SURNAME_ST_2 = 'Р.' AND T_NAME_ST_2 = 'Д.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1992-08-14', DATA_WORK_ST = '2015-09-01'
WHERE NAME_ST_2 = 'Заборовский' AND SURNAME_ST_2 = 'А.' AND T_NAME_ST_2 = 'Р.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1996-03-30', DATA_WORK_ST = '2013-09-01'
WHERE NAME_ST_2 = 'Савицкаян' AND SURNAME_ST_2 = 'Н.' AND T_NAME_ST_2 = NULL

UPDATE FACULTET
SET BIRTH_ST_2 = '1998-11-12', DATA_WORK_ST = '2015-09-01'
WHERE NAME_ST_2 = 'Ковальчук' AND SURNAME_ST_2 = 'М.' AND T_NAME_ST_2 = 'Е.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1995-07-19', DATA_WORK_ST = '2012-09-01'
WHERE NAME_ST_2 = 'Ковриго' AND SURNAME_ST_2 = 'Т.' AND T_NAME_ST_2 = 'Р.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1999-01-05', DATA_WORK_ST = '2016-09-01'
WHERE NAME_ST_2 = 'Ковальский' AND SURNAME_ST_2 = 'А.' AND T_NAME_ST_2 = 'С.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1994-10-22', DATA_WORK_ST = '2011-09-01'
WHERE NAME_ST_2 = 'Степанчук' AND SURNAME_ST_2 = 'И.' AND T_NAME_ST_2 = 'Н.'

UPDATE FACULTET
SET BIRTH_ST_2 = '1997-06-14', DATA_WORK_ST = '2014-09-01'
WHERE NAME_ST_2 = 'Шарапо' AND SURNAME_ST_2 = 'Н.' AND T_NAME_ST_2 = NULL

INSERT INTO FACULTET (NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2 , COURSE_GR_ST_2,SRED_BALL, TUP_OB_ST, FACUL_ST,BIRTH_ST_2,DATA_WORK_ST)  VALUES
('Коваленко', 'И.', 'С.', 1, 3, 'заочный', 'ФПМ', '1998-04-10', '2015-09-01'),
('Лещенко', 'М.', NULL, 2, 8, 'очный', 'ФПК', '1996-07-22', '2015-09-01'),
('Мелицкий', 'А.', 'В.', 1, 5, 'очный', 'ФПМ', '1997-01-15', '2014-09-01'),
('Григорьев', 'П.', 'Н.', 2, 6, 'заочный', 'ФПК', '1995-11-30', '2014-09-01'),
('Мельничук', 'Е.', 'А.', 1, 4, 'очный', 'ФПМ', '1999-03-25', '2015-09-01'),
('Тарасов', 'Ю.', NULL, 2, 7, 'заочный', 'ФПК', '1996-06-18', '2015-09-01'),
('Бондарь', 'С.', 'И.', 1, 2, 'очный', 'ФПМ', '1980-09-09', '2013-09-01'),
('Кириленко', 'Н.', 'О.', 2, 5, 'заочный', 'ФПК', '1997-12-01', '2012-09-01'),
('Данилов', 'А.', 'К.', 1, 6, 'очный', 'ФПМ', '1995-07-07', '2010-09-01'),
('Зайцев', 'Л.', 'М.', 2, 3, 'заочный', 'ФПК', '1998-02-14', '2013-09-01'),
('Романов', 'В.', 'С.', 1, 1, 'очный', 'ФПМ', '1999-10-10', '2014-09-01'),
('Павленко', 'Т.', NULL, 2, 4, 'заочный', 'ФПК', '1996-05-05', '2011-09-01'),
('Сидоренко', 'К.', 'Д.', 1, 7, 'очный', 'ФПМ', '1997-08-08', '2012-09-01'),
('Романов', 'И.', 'Г.', 2, 2, 'заочный', 'ФПК', '1975-03-03', '2014-09-01'),
('Кузнецова', 'А.', 'Е.', 1, 8, 'очный', 'ФПМ', '1998-12-12', '2013-09-01'),
('Мороз', 'О.', NULL, 2, 9, 'заочный', 'ФПМ', '1978-01-01', '2014-09-01'),
('Волкова', 'Н.', 'Т.', 1, 5, 'очный', 'ФПМ', '1997-06-06', '2012-09-01'),
('Чернов', 'Д.', 'А.', 2, 6, 'заочный', 'ФПК', '1995-04-04', '2010-09-01'),
('Гаврилюк', 'С.', 'Ю.', 1, 3, 'очный', 'ФПМ', '1999-11-11', '2014-09-01'),
('Новицкий', 'Е.', NULL, 2, 7, 'заочный', 'ФПК', '1980-09-09', '2015-09-01')

SELECT NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2,TUP_OB_ST, FACUL_ST,COURSE_GR_ST_2 FROM FACULTET
	WHERE TUP_OB_ST = 'заочный' AND DATEDIFF(YEAR, BIRTH_ST_2, GETDATE()) < 37
    
--2
SELECT FACUL_ST, COUNT(*) AS FACULTET_ST FROM FACULTET
GROUP BY FACUL_ST

--3
SELECT TUP_OB_ST, COUNT(*) AS TUP_OB_OCHN FROM FACULTET
	WHERE TUP_OB_ST = 'очный'
GROUP BY TUP_OB_ST

SELECT TUP_OB_ST, COUNT(*) AS TUP_OB_ZAOCHN FROM FACULTET
	WHERE TUP_OB_ST = 'заочный'  
GROUP BY TUP_OB_ST    
    
--4
SELECT FACUL_ST, AVG(DATEDIFF(YEAR, BIRTH_ST_2, '2025-12-31')) AS AVG_AGE FROM FACULTET
GROUP BY FACUL_ST

--5
SELECT NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2 ,DATA_WORK_ST,FACUL_ST,COURSE_GR_ST_2,TUP_OB_ST FROM FACULTET 
	WHERE T_NAME_ST_2 IS NULL

--6
SELECT FACUL_ST, COUNT(*) AS NUM_ST_2015 FROM FACULTET 
	WHERE YEAR(DATA_WORK_ST) = 2015
GROUP BY FACUL_ST
ORDER BY NUM_ST_2015 DESC


--7
SELECT FACUL_ST, TUP_OB_ST, COUNT(*) AS NUM_ST_2014 FROM FACULTET 
	WHERE YEAR(DATA_WORK_ST) = 2014
GROUP BY FACUL_ST, TUP_OB_ST
ORDER BY NUM_ST_2014 DESC

--8
SELECT  FACUL_ST FROM FACULTET 
	WHERE TUP_OB_ST = 'заочный'

--9
SELECT FACUL_ST, TUP_OB_ST, COURSE_GR_ST_2 FROM FACULTET 
GROUP BY FACUL_ST, TUP_OB_ST,  COURSE_GR_ST_2
ORDER BY FACUL_ST, TUP_OB_ST, COURSE_GR_ST_2

--10
SELECT FACUL_ST, TUP_OB_ST, COUNT(*) AS NUM_TUP_OB FROM FACULTET 
GROUP BY FACUL_ST, TUP_OB_ST
ORDER BY FACUL_ST, TUP_OB_ST

--11
SELECT FACUL_ST, TUP_OB_ST,COURSE_GR_ST_2, COUNT(*) AS NUM_ST_1_3 FROM FACULTET 
	WHERE COURSE_GR_ST_2  IN (1, 3)
GROUP BY FACUL_ST, TUP_OB_ST
ORDER BY FACUL_ST, TUP_OB_ST

--12
SELECT FACUL_ST,COURSE_GR_ST_2,COUNT(*) AS NUM_ST_T_NAME_NULL FROM FACULTET 
	WHERE T_NAME_ST_2 IS NULL
GROUP BY FACUL_ST, COURSE_GR_ST_2
ORDER BY FACUL_ST, COURSE_GR_ST_2

--13
SELECT FACUL_ST, COURSE_GR_ST_2, COUNT(*) AS NUM_SRED_BALL_ST FROM FACULTET
	WHERE SRED_BALL > 7.5
GROUP BY FACUL_ST, COURSE_GR_ST_2
ORDER BY FACUL_ST, COURSE_GR_ST_2

--14
SELECT NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2, FACUL_ST, TUP_OB_ST, COUNT(*) AS NUM_ST_45 FROM FACULTET 
	WHERE DATEDIFF(YEAR, BIRTH_ST_2, GETDATE()) > 45
GROUP BY FACUL_ST, TUP_OB_ST
ORDER BY FACUL_ST, TUP_OB_ST

--15
SELECT NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2, FACUL_ST, TUP_OB_ST,COURSE_GR_ST_2, COUNT(*) AS NUM_ST_27 FROM FACULTET 
	WHERE DATEDIFF(YEAR, BIRTH_ST_2, GETDATE()) < 27
GROUP BY FACUL_ST, TUP_OB_ST,COURSE_GR_ST_2
ORDER BY FACUL_ST, TUP_OB_ST,COURSE_GR_ST_2

--16
SELECT NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2, FACUL_ST, COUNT(*) AS NUM_ST_S FROM FACULTET 
	WHERE NAME_ST_2 LIKE'C%'
GROUP BY FACUL_ST
ORDER BY NUM_ST_S ASC

--17
SELECT 
    PREPOD.NAME_PREP, PREPOD.SURNAME_PREP, PREPOD.T_NAME_PREP, PREPOD.TUP_OB_PREP,
    STUDENTS.NAME_ST_2, STUDENTS.SURNAME_ST_2, STUDENTS.T_NAME_ST_2, STUDENTS.TUP_OB_ST FROM PREPOD
JOIN STUDENTS ON PREPOD.TUP_OB_PREP = STUDENTS.TUP_OB_ST
ORDER BY  PREPOD.NAME_PREP, PREPOD.SURNAME_PREP, PREPOD.T_NAME_PREP,
    STUDENTS.NAME_ST_2, STUDENTS.SURNAME_ST_2, STUDENTS.T_NAME_ST_2
    
--18
SELECT PREPOD.NAME_PREP, PREPOD.SURNAME_PREP, PREPOD.T_NAME_PREP FROM PREPOD
	JOIN STUDENTS ON PREPOD.NAME_PREP = STUDENTS.NAME_ST_2
ORDER BY PREPOD.NAME_PREP, PREPOD.SURNAME_PREP

--19
SELECT PREPOD.NAME_PREP, PREPOD.SURNAME_PREP, PREPOD.T_NAME_PREP FROM PREPOD 
	JOIN STUDENTS  ON PREPOD.NAME_PREP <> STUDENTS.NAME_ST_2
ORDER BY PREPOD.NAME_PREP


--lab_3/4_ ЧАСТЬ_2

--1
CREATE PROCEDURE NUM_ST_FACUL_TUP_OB
    @FACULT_NAME CHAR(100),
    @TUP_OB_NAME CHAR(20)
AS
BEGIN
    SET NOCOUNT ON
    DECLARE @NUM_ST INT
    
    SELECT @NUM_ST = COUNT(*)
    FROM FACULTET
    WHERE FACUL_ST = @FACULT_NAME AND TUP_OB_ST = @TUP_OB_NAME 

    PRINT 'Факультет: ' + @FACULT_NAME
    PRINT 'Форма обучения: ' + @TUP_OB_NAME
    PRINT 'Количество студентов: ' + CAST(@NUM_ST AS NVARCHAR)
END

--2
CREATE PROCEDURE NUM_ST_PREDMET_FACULTET
AS
BEGIN
    SET NOCOUNT ON

    DECLARE @PRED_FPK INT
    DECLARE @PRED_FPM INT
    DECLARE @NUM_PREDMET INT
    DECLARE @NUM_PREDMET_FACULT INT

    SELECT @PRED_FPK = COUNT(*) 
    FROM PREPOD
    WHERE FACULTY_NAME = 'ФПК'

    SELECT @PRED_FPM = COUNT(*) 
    FROM PREPOD
    WHERE FACULTY_NAME = 'ФПМ'

    SELECT @NUM_PREDMET = COUNT(*) FROM PREPOD

    SELECT @NUM_PREDMET_FACULT = COUNT(*) 
    FROM (
        SELECT PREDMET_PREP FROM PREPOD
        GROUP BY PREDMET_PREP
        HAVING COUNT(DISTINCT FACUL_PREP) > 1
    ) AS Duplicates

    PRINT 'Для ФПК читается ' + CAST(@PRED_FPK AS NVARCHAR) + ' предметов'
    PRINT 'Для ФПМ читается ' + CAST(@PRED_FPM AS NVARCHAR) + ' предметов'
    PRINT 'Всего ' + CAST(@NUM_PREDMET AS NVARCHAR) + ' предметов (из которых ' + CAST(@NUM_PREDMET_FACULT AS NVARCHAR) + ' идентичны)'
END

--3

CREATE PROCEDURE ADD_STUDENT_FAC_TUP_OB
    @FACULT_NAME CHAR(100),
    @TUP_OB_NAME CHAR(10),
    @BIRTH_DATE DATE,
    @WORK_DATE DATE,
    @NAME_ST_3 CHAR(20),
    @SURNAME_ST_3 CHAR(20),
    @T_NAME_ST_3 CHAR(20)
AS
BEGIN
    SET NOCOUNT ON

    IF NOT EXISTS (
        SELECT 1
        FROM FACULTET
        WHERE FACUL_ST = @FACULT_NAME AND TUP_OB_ST = @TUP_OB_NAME
    )
    BEGIN
        PRINT 'Ошибка: комбинация факультета и формы обучения не существует'
        RETURN
    END

    INSERT INTO FACULTET (NAME_ST_2,SURNAME_ST_2, T_NAME_ST_2, COURSE_GR_ST_2, SRED_BALL, TUP_OB_ST, FACUL_ST,BIRTH_ST_2,DATA_WORK_ST)
    VALUES (@NAME_ST_3,@SURNAME_ST_3,@T_NAME_ST_3, 1,NULL,@TUP_OB_NAME,@FACULT_NAME,@BIRTH_DATE,@WORK_DATE )

    PRINT 'Студент зачислен на 1 курс'
END



